<!DOCTYPE html>
<html>
<head>
  <title>Preview Check Report</title>
  <style>
    body { font-family: system-ui, -apple-system, sans-serif; padding: 20px; color: #333; }
    .summary { margin-bottom: 20px; padding: 15px; background: #f5f5f5; border-radius: 8px; }
    .passed { color: green; }
    .failed { color: red; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { text-align: left; padding: 10px; border-bottom: 1px solid #ddd; }
    th { background: #f0f0f0; }
    tr.error { background: #fff0f0; }
    .backtrace { font-family: monospace; font-size: 0.9em; white-space: pre-wrap; color: #666; }
  </style>
</head>
<body>
  <h1>Preview Check Report</h1>
  
  <div class="summary">
    <p><strong>Total Checks:</strong> <%= results.size %></p>
    <p><strong>Passed:</strong> <span class="passed"><%= success_count %></span></p>
    <p><strong>Failed:</strong> <span class="failed"><%= errors.size %></span></p>
    <p><strong>Total Duration:</strong> <%= total_duration.round(2) %>s</p>
  </div>

  <h2>Top 5 Slowest Previews</h2>
  <ul>
    <% results.sort_by { |r| -r.duration.to_f }.first(5).each do |res| %>
      <li><strong><%= res.duration.to_f.round(4) %>s</strong> - <%= res.preview_name %>#<%= res.example_name %></li>
    <% end %>
  </ul>

  <h2>Detailed Results</h2>
  <table>
    <thead>
      <tr>
        <th>Status</th>
        <th>Preview</th>
        <th>Example</th>
        <th>Time (s)</th>
        <th>Error</th>
      </tr>
    </thead>
    <tbody>
      <% results.sort_by { |r| r.status == :failed ? 0 : 1 }.each do |result| %>
        <tr class="<%= 'error' if result.status == :failed %>">
          <td class="<%= result.status %>"><%= result.status.to_s.upcase %></td>
          <td><%= result.preview_name %></td>
          <td><%= result.example_name %></td>
          <td><%= result.duration.to_f.round(4) %></td>
          <td>
            <% if result.error %>
              <div><strong><%= result.error %></strong></div>
              <div class="backtrace"><%= result.backtrace&.first(5)&.join("\n") %></div>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</body>
</html>
